#!/bin/bash

# Apply the updated blue deployment
echo "Applying updated blue deployment with image version 2.0..."
kubectl apply -f messaging_app/blue_deployment.yaml

# Monitor the rollout status
echo "Monitoring rollout status..."
kubectl rollout status deployment/django-blue

# Run continuous curl requests in background to test downtime
echo "Testing for downtime (Ctrl+C to stop)..."
for i in {1..20}
do
    curl -s http://<your-minikube-ip>/ || echo "Request failed!"
    sleep 1
done

# Verify updated pods
echo "Current pods:"
kubectl get pods -l app=django,version=blue -o wide
